<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/x-icon" href="../../../static/favicon.ico?h=e38ef9dd">
<link rel="stylesheet" href="../../../static/lib/normalize.css?h=ece571f3">
<link rel="stylesheet" href="../../../static/lib/skeleton.css?h=1fd77917">
<link rel="stylesheet" href="../../../static/style.css?h=5db9e889">
<link rel="stylesheet" href="../../../static/lib/medium-editor/medium-editor.min.css?h=17e98ac9">
<link rel="stylesheet" href="../../../static/fonts/anonymous-pro/anonymous-pro.css?h=7b3d4039">
<link rel="stylesheet" href="../../../static/fonts/fa/css/font-awesome.min.css?h=512c7d79">
<link rel="stylesheet" href="../../../static/fonts/ionicons/css/ionicons.min.css?h=f0459300">
<link rel="stylesheet" href="../../../static/fonts/source-sans-pro/source-sans-pro.css?h=eef2e813">

<!-- <script src="../../../static/lib/clipboard.min.js?h=64efc85d"></script> -->
<script src="../../../static/lib/jquery-2.2.1.min.js?h=7cb05e3d"></script>
<script src="../../../static/lib/marked.js?h=acaa528b"></script>
<script src="../../../static/lib/MooTools-Core-1.6.0.js?h=f829fe22"></script>
<script src="../../../static/lib/sprintf.js?h=f8d59971"></script>
<script src="../../../static/lib/medium-editor/medium-editor.min.js?h=d2c3e1bb"></script>
<script src="../../../static/lib/me-markdown.standalone.min.js?h=f8bd91a7"></script>
<script src="../../../static/lr-notebook.js?h=9fb07e66"></script>


<title></title>
<body>
  <header>
    <h1><i class="fa fa-sticky-note-o"></i> nb-Gabe_Fischbach</h1>
    <nav>
      <ul class="nav navbar-nav">
        <li><a  href="../../../">Welcome</a></li>
        
          <li><a  class="active" href="../../../projects/">Projects</a></li>
        
          <li><a  href="../../../calendar/">Calendar</a></li>
        
          <li><a  href="../../../meetings/">Meetings</a></li>
        
          <li><a  href="../../../about/">About</a></li>
        
      </ul>
    </nav>
    
  </header>

  <iframe width="0" height="0" border="0" name="frame" style="border-style: none;"></iframe>

  <div class="page">
    
<h2 style="display: inline;"><a class="orange" href="../../../projects/CAS/">CAS/</a></h2><br>
<form target="frame" action="/admin/api/browsefs" method="post">
  <input type="hidden" name="path" value="/projects/CAS/2017-05-18">
  <input type="image" src=../../../static/images/link.png>
</form>
<h2 class="lightblue" style="display: inline;">PFAM Data Structures</h2> <span style="float:right;" class="midgray">2017-05-18</span> 
<hr>


<h5 style="float:left;">Attachments:</h5>


<div class="row">
  <div class="one column"></div>
  <div class="two columns"><!-- Attachments: --></div>
<div class="nine columns">
    
    
    
        <a class="green" href="../../../projects/CAS/2017-05-18/filter_REC.sh">filter_REC.sh</a>
        
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
 
 
  
  
  
,
    
        <a class="green" href="../../../projects/CAS/2017-05-18/make_blocks.py">make_blocks.py</a>
        
  
  
  
  
  
  
  
  
  
  
  
  <i aria-hidden="true" class="icon ion-social-python"></i>
  
  
  
  
 
 
  
  
  
,
    
        <a class="green" href="../../../projects/CAS/2017-05-18/pfam_object.py">pfam_object.py</a>
        
  
  
  
  
  
  
  
  
  
  
  
  <i aria-hidden="true" class="icon ion-social-python"></i>
  
  
  
  
 
 
  
  
  

    
  </div>
</div>


<hr>






<div id="entry">
    <h2>CAS 5-18-17</h2>
<p>I wrote another sort shell script (check_REC.sh) that checks for unique hits of Cas9_REC keyword in each .pfd file. Uses the -q flag to look for first hit of keyword in file and piped the output of the script (printed file names) to wc -l. Got 158 hits and 158 hits for ls *.pfd | wc -l which, so I think that each file in there has at least one instance of Cas9_REC and some have more. It might be interesting to see which ones have more. Shell script code:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">cd</span> all_pfam

<span class="nv">array</span><span class="o">=(</span>*.pfd<span class="o">)</span>

<span class="k">for</span> i in <span class="s2">&quot;</span><span class="si">${</span><span class="nv">array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">do</span>
    <span class="k">if</span> <span class="k">$(</span>grep <span class="s2">&quot;-q&quot;</span> <span class="s2">&quot;Cas9_REC&quot;</span> <span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">&quot;</span><span class="k">)</span>
    <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">&quot;</span>
    <span class="k">fi</span>
<span class="k">done</span>
</pre></div>
<p>At this point I may want to automate the process of collecting and cleaning up this data? Or probably better would be to keep going and get to the point where I can do some analysis. Just be smart and leave enough of a paper trail to do similar things with other PFAM keywords if I'm interested.</p>
<hr>
<p>I think what I want to do is something like I did for S. Pyogenes, grabbing the surrounding PFAM terms like I did in make_blocks.py.</p>
<p>I'm going to modify make_blocks so that it takes an input PFAM term as ARGV[1].</p>
<p>Think I should take a minute to clean up the CAS project file structure. I'm going to organize by PFAM term...is that the best way of doing things?</p>
<p>Right now I have cas9_genomes -&gt; all_cas9_species -&gt; all_pfam which I don't think works like I would want it to. I'm going to organize the file structure to look something like this:</p>
<table>
<thead><tr>
<th>CAS</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td></td>
</tr>
<tr>
<td>pfam_ID</td>
<td></td>
</tr>
<tr>
<td>all_gb</td>
<td>all_fasta</td>
<td>all_pfam</td>
<td>blocks.out</td>
</tr>
</tbody>
</table>
<p>I'll migrate the scripts up to the top level eventually. When I go back and try to generalize, I'll have to migrate over scripts to the top directory and also add in a portion of scraping the right data.</p>
<p>As I'm updating this code I think it might be worth it to quickly define some objects/classes. It's becoming pretty hard to keep track of what's what as I run into hits and that was a problem I'm having before.</p>
<p>Created a pfam object stored in file pfam_object.py. Takes a stripped list split by '\t' delimiter from .pfd file and saves everything into the coresponding attributes:</p>
<pre><code>file
locus_tag 
start_loc 
end_loc 
strand 
pfam_num 
pfam_id 
sequence
</code></pre>
<p>Now also have blocks being spit out in new format. Have three 'blocks' (term_blocks, before_blocks, after_blocks)</p>
<p>Term blocks is a list of all the pfam object hits coming from the lines where the target pfam term was found (so in this case, a list of all the pfam objects created from the lines where Cas9_REC was found).</p>
<p>Before blocks is a list of lists of pfam objects. Each list is of size WINDOW_HALF_SIZE and is a list of sequential pfam objects looking at what's before the pfam target hit.</p>
<p>After blocks is similar to before blocks, just the terms that come after. Should I be including the sequence here? Might be a good spot to save the AA sequence just in case I want to go deeper than just the pfam_term.</p>
<p>I think I'm going to take a minute to do that.</p>
<p>also...side note...going to get rid of the 'all' notation in the folders. <strong>Just going to have ./fasta and ./gb and ./pfam</strong></p>
<p>Gotta remember that when I go back into the other scripts.</p>
<h2>Grabbing AA Sequences</h2>
<p>Went back into the batch pfam conversion script (cas9_pfam_cluster.py) and it looks like the AA sequence for each PFAM find is saved, just never used. There's a dict in there called seqdict that I think is holding the sequences?</p>
<p>I just added a line, grabbing the sequence from there and writing it to the line in the output .pfd file.</p>
<p>Looks like the exsits_ok argument won't fly on the cluster because it's not running python3....</p>
<p>Removed that argument and it seemed to work ok. Hopefully won't affect the call when the file already exists (/hmmer_aux_files/ didn't exist on this call) but worth keeping in mind in the future if something comes up.</p>
<p>Now storing the AA sequence should be as straightforward as going back as just adding another attribute to the pfam object constructor and taking the last element of the passed list (line split by '\t') as the AA sequence.</p>
<h2>Block and Hits Data Structure</h2>
<p>Created two data structures, block and hits. The block and hits objects object has the following fields</p>
<pre><code>pfam_objects
start_locs
end_locs
strands
pfam_nums
pfam_ids
sequences

hits
slots
</code></pre>
<p>The hits and slots fields are only present in the block data structure. Hits is the number of lines that were found with the pfam search term (e.g. the number of Cas9_REC hits). Slots is equal to the half window size from make_blocks. So if we're looking 25 slots on each side of Cas9_REC there is a before_block and an after_block and each one has 25 slots.</p>
<h2>Visualization</h2>
<p>I think I should repurpose the Arrower code from before to be drawing the PFAM domains that I've found here.</p>

</div>






<pre style="display:none;" class="markdown"></pre>

<script>
  function renderRightAsMarkdown() {
      var right = document.getElementsByClassName("right");
      for (var i=0; i<right.length; i++) {
          src = right[i].innerHTML
          right[i].innerHTML = marked(src);
      }
  }
  renderRightAsMarkdown();
</script>




<script>

// Disable clipboard stuff for now
// var pre = document.getElementsByTagName('pre');
// for (var i = 0; i < pre.length; i++) {
//   var button = document.createElement('button');
//   button.className = 'btn fa fa-copy';
//   pre[i].appendChild(button);
// }

// var clipboard = new Clipboard('.btn', {
//   target: function(trigger) {return trigger.previousElementSibling;}
// });

// function showSuccess(elem){elem.setAttribute('class','btn fa fa-check');}
// function sleep (time) {return new Promise((resolve) => setTimeout(resolve, time));}
// clipboard.on('success',function(e){
//   showSuccess(e.trigger);
//   sleep(350).then(() => {e.clearSelection();
//     e.trigger.setAttribute('class','btn fa fa-copy');})
// });

// Experimental direct editing

// var paragraphs = $$("#entry>p");
// var lastEl = paragraphs.getLast();
// var path = '/projects/CAS/2017-05-18';

// paragraphs.each(function(el) {
//   var dropArea = new Element('div', {'class':'right droparea',
//                                      'ondrop':'drop(event, path)',
//                                      'ondragover':'dragover_handler(event)'
//                                      });
//   var next = el.getNext();
//   if (!!next && !next.hasClass('right')) {
//     droptext = new Element('div', {'id':'targetString',
//                                    styles:{display: 'none'},
//                                    'html':el.get('html')
//                                   });
//     droptext.inject(dropArea);
//     dropArea.inject(el, 'after');
//   }
// });

// var rightimgs = $$("img.thumb");
// rightimgs.each(function(el) {
//   var button = document.createElement('button');
//   button.className = 'btn fa fa-window-close';
//   el.appendChild(button);
// });

// var markDownEl = document.querySelector(".markdown");

// new MediumEditor($$("#entry>p"), {
//     extensions: {markdown: new MeMarkdown(function (md) {markDownEl.textContent = md;})},
//     toolbar: {
//       allowMultiParagraphSelection: false,
//       buttons: ['bold', 'italic', 'underline']
//     },
//     disableReturn: true,
//     disableDoubleReturn: true,
//     disableExtraSpaces: true,
//     paste: {
//         forcePlainText: true,
//         cleanPastedHTML: true
//     }
// });

</script>

<a href="slides" id="play-slides-link"><i class="fa fa-play" aria-hidden="true"></i></a>


  </div>

  <footer>
    &copy; 2016. Made with <a target="_new" href="http://bionano.ucsf.edu/"><i class="fa fa-gears"></i></a> in SF.
  </footer>

</body>
