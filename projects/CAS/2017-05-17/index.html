<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/x-icon" href="../../../static/favicon.ico?h=e38ef9dd">
<link rel="stylesheet" href="../../../static/lib/normalize.css?h=ece571f3">
<link rel="stylesheet" href="../../../static/lib/skeleton.css?h=1fd77917">
<link rel="stylesheet" href="../../../static/style.css?h=5db9e889">
<link rel="stylesheet" href="../../../static/lib/medium-editor/medium-editor.min.css?h=17e98ac9">
<link rel="stylesheet" href="../../../static/fonts/anonymous-pro/anonymous-pro.css?h=7b3d4039">
<link rel="stylesheet" href="../../../static/fonts/fa/css/font-awesome.min.css?h=512c7d79">
<link rel="stylesheet" href="../../../static/fonts/ionicons/css/ionicons.min.css?h=f0459300">
<link rel="stylesheet" href="../../../static/fonts/source-sans-pro/source-sans-pro.css?h=eef2e813">

<!-- <script src="../../../static/lib/clipboard.min.js?h=64efc85d"></script> -->
<script src="../../../static/lib/jquery-2.2.1.min.js?h=7cb05e3d"></script>
<script src="../../../static/lib/marked.js?h=acaa528b"></script>
<script src="../../../static/lib/MooTools-Core-1.6.0.js?h=f829fe22"></script>
<script src="../../../static/lib/sprintf.js?h=f8d59971"></script>
<script src="../../../static/lib/medium-editor/medium-editor.min.js?h=d2c3e1bb"></script>
<script src="../../../static/lib/me-markdown.standalone.min.js?h=f8bd91a7"></script>
<script src="../../../static/lr-notebook.js?h=9fb07e66"></script>


<title></title>
<body>
  <header>
    <h1><i class="fa fa-sticky-note-o"></i> nb-fischbach</h1>
    <nav>
      <ul class="nav navbar-nav">
        <li><a  href="../../../">Welcome</a></li>
        
          <li><a  class="active" href="../../../projects/">Projects</a></li>
        
          <li><a  href="../../../calendar/">Calendar</a></li>
        
          <li><a  href="../../../meetings/">Meetings</a></li>
        
          <li><a  href="../../../about/">About</a></li>
        
          <li><a  href="../../../shared/">Shared</a></li>
        
      </ul>
    </nav>
    
  </header>

  <iframe width="0" height="0" border="0" name="frame" style="border-style: none;"></iframe>

  <div class="page">
    
<h2 style="display: inline;"><a class="orange" href="../../../projects/CAS/">CAS/</a></h2><br>
<form target="frame" action="/admin/api/browsefs" method="post">
  <input type="hidden" name="path" value="/projects/CAS/2017-05-17">
  <input type="image" src=../../../static/images/link.png>
</form>
<h2 class="lightblue" style="display: inline;">Batch PFAM cleanup</h2> <span style="float:right;" class="midgray">2017-05-17</span> 
<hr>


<h5 style="float:left;">Attachments:</h5>


<div class="row">
  <div class="one column"></div>
  <div class="two columns"><!-- Attachments: --></div>
<div class="nine columns">
    
    
    
        <a class="green" href="../../../projects/CAS/2017-05-17/filter_REC.sh">filter_REC.sh</a>
        
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
 
 
  
  
  

    
  </div>
</div>


<hr>





<div id="entry">
    <h2>CAS 5-17-17</h2>
<p>Most of the batch PFAM conversion seemed to have worked ok. I'm a little worried about the files where there's no PFAM output.</p>
<p>When I convert everything to fasta files using the genbank_to_fasta in the HSV project folder, I'm also getting a lot of empty resulting fasta files. There's a lot of overlap between the empty fasta files and the empty resulting PFAM files.</p>
<p>The output of some of the files had an error -</p>
<pre><code>    Traceback (most recent call last):
    File "./genbank_to_fasta_v1.1/genbank_to_fasta.py", line 299, in &lt;module&gt;
    fasta_records = genbank_to_fasta(record, sequence_type, qualifier_list)
    File "./genbank_to_fasta_v1.1/genbank_to_fasta.py", line 262, in genbank_to_fasta
    temp_seq = get_nt_seq(feature).translate(table = translation_table)
    File "./genbank_to_fasta_v1.1/genbank_to_fasta.py", line 208, in get_nt_seq
    if len(feature.sub_features) == 0:
AttributeError: 'SeqFeature' object has no attribute 'sub_features'
</code></pre>
<p>Which looks like it might be an error having to do with the newest version of biopython (sub_features may have been deprecated going from version 1.67 to 1.68). So added in a quick fix line in the genbank_to_fasta.py code in the get_nt_seq function before sub_features get referened:</p>
<pre><code>    if not hasattr(feature, "sub_features"):
        feature.sub_features = []
</code></pre>
<p>It looks like this is resulting in some new non-empty fasta files, but there are still some empty ones. Definitely less now, but still a handlful of empty files.</p>
<p>Actually, just changed up the fix. Pip uninstalled biopython and ran</p>
<pre><code>    pip install biopython==1.67
</code></pre>
<p>to force installation of biopython 1.67. Commented out the fix line above and it works just as well. Still getting the same empty files though...</p>
<p>Checked the .gbff files and it looks like there's no CDS regions for these files. I don't know if there's any way around that...</p>
<p>Still doesn't explain why the PFAM files are empty for the .gbff files that have the CDS regions. Is it the same issue with biopython?</p>
<p>Turns out those files without any CDS annotation might all be whole genome files with no CDS annotation.</p>
<p>I made a shell script to remove these files from the all_gb folder (any file that doesn't have any CDS annotation got removed)</p>
<pre><code>#!/bin/bash

cd all_gb
array=(*)
# cd ..
# top_dir="$PWD"

for i in "${array[@]}"
do
    if !($(grep "-q" "CDS" "$i"))
        then
            echo "Removing $i ..."
            rm "$i"
        fi
done
</code></pre>
<p>After removing these files, re-uploading to the cluster and re-running PFAM conversion on the files it looks like that was the biggest issue. There are no empty PFAM files, though there are still some that are small (though the small files are now all .pfs files which is a good sign). Looked at the smallest .pfs file and saw its .pfd file, looks like it has a cas9_rec domain.</p>
<p>Just checked how many of the .pfd files has Cas9_REC in them by running</p>
<pre><code>grep Cas9_REC *.pfd | wc -l 
</code></pre>
<p>and it looks like there are 162 files with Cas9_REC. But when I run</p>
<pre><code>ls *.pfd | wc -l
</code></pre>
<p>there are 199 .pfd files which means that a good number of them don't have Cas9_REC in them.</p>
<p>Checking on the PFAM website though, it looks like there are less than 199 sequences with Cas9_REC. According to the <a href="http://pfam.xfam.org/family/PF16592#tabview=tab7">PFAM website</a> looks like there are 146 sequences with the Cas9_REC domain?</p>
<p>I think if I try automating this process, I need to scrape the sequences from the website in a better way? I did it from the tree file...but maybe that gave me extra ones?</p>
<p>So I'm going to do another filtering step, write a quick shell script to take out any .pfd/.pfs file combo that doesn't have Cas9_REC.</p>
<p>Wrote in script filter_REC.sh.</p>
<p>Removed some .pfd/.pfs files that don't have Cas9_REC. But...when I do grep + wc for Cas9_REC I get 162 .pfd hits and when I do ls to wc I get 158? There must be some .pfd files with repeat Cas9_REC appearences, but have to check that.</p>

</div>






<pre style="display:none;" class="markdown"></pre>

<script>
  function renderRightAsMarkdown() {
      var right = document.getElementsByClassName("right");
      for (var i=0; i<right.length; i++) {
          src = right[i].innerHTML
          right[i].innerHTML = marked(src);
      }
  }
  renderRightAsMarkdown();
</script>




<script>

// Disable clipboard stuff for now
// var pre = document.getElementsByTagName('pre');
// for (var i = 0; i < pre.length; i++) {
//   var button = document.createElement('button');
//   button.className = 'btn fa fa-copy';
//   pre[i].appendChild(button);
// }

// var clipboard = new Clipboard('.btn', {
//   target: function(trigger) {return trigger.previousElementSibling;}
// });

// function showSuccess(elem){elem.setAttribute('class','btn fa fa-check');}
// function sleep (time) {return new Promise((resolve) => setTimeout(resolve, time));}
// clipboard.on('success',function(e){
//   showSuccess(e.trigger);
//   sleep(350).then(() => {e.clearSelection();
//     e.trigger.setAttribute('class','btn fa fa-copy');})
// });

// Experimental direct editing

// var paragraphs = $$("#entry>p");
// var lastEl = paragraphs.getLast();
// var path = '/projects/CAS/2017-05-17';

// paragraphs.each(function(el) {
//   var dropArea = new Element('div', {'class':'right droparea',
//                                      'ondrop':'drop(event, path)',
//                                      'ondragover':'dragover_handler(event)'
//                                      });
//   var next = el.getNext();
//   if (!!next && !next.hasClass('right')) {
//     droptext = new Element('div', {'id':'targetString',
//                                    styles:{display: 'none'},
//                                    'html':el.get('html')
//                                   });
//     droptext.inject(dropArea);
//     dropArea.inject(el, 'after');
//   }
// });

// var rightimgs = $$("img.thumb");
// rightimgs.each(function(el) {
//   var button = document.createElement('button');
//   button.className = 'btn fa fa-window-close';
//   el.appendChild(button);
// });

// var markDownEl = document.querySelector(".markdown");

// new MediumEditor($$("#entry>p"), {
//     extensions: {markdown: new MeMarkdown(function (md) {markDownEl.textContent = md;})},
//     toolbar: {
//       allowMultiParagraphSelection: false,
//       buttons: ['bold', 'italic', 'underline']
//     },
//     disableReturn: true,
//     disableDoubleReturn: true,
//     disableExtraSpaces: true,
//     paste: {
//         forcePlainText: true,
//         cleanPastedHTML: true
//     }
// });

</script>

<a href="slides" id="play-slides-link"><i class="fa fa-play" aria-hidden="true"></i></a>


  </div>

  <footer>
    &copy; 2016. Made with <a target="_new" href="http://bionano.ucsf.edu/"><i class="fa fa-sliders"></i></a> in SF.
  </footer>

</body>
